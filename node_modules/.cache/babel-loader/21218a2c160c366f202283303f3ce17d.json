{"ast":null,"code":"import { BehaviorSubject } from 'rxjs';\nimport { webSocket } from '@akanass/rx-socket-client';\nimport config from '../config';\nimport { handleResponse } from '../helpers/handle-response';\n\nvar jwtDecode = require('jwt-decode');\n\nconst Auth = new BehaviorSubject(JSON.parse(localStorage.getItem('auth'))); // const Ws = webSocket(`${config.PAYTOK_WS_URL}/paytok/?${Auth.auth}`);yarn add @akanass/rx-socket-clien√\n\nexport const authenticationService = {\n  login,\n  logout,\n  refresh,\n  auth: Auth.asObservable(),\n\n  get currentUser() {\n    return Auth.value && Auth.value.data.user_id;\n  },\n\n  get accessToken() {\n    return Auth.value && Auth.value.access;\n  },\n\n  get refreshToken() {\n    return Auth.value && Auth.value.refresh;\n  },\n\n  get tokenExp() {\n    return Auth.value && Auth.value.data.exp;\n  } // get WebSoc\n\n\n};\n\nfunction login(username, password) {\n  const requestOptions = {\n    method: 'POST',\n    headers: {\n      'Content-Type': 'application/json'\n    },\n    body: JSON.stringify({\n      'email': username,\n      password\n    })\n  };\n  return fetch(`${config.PAYTOK_URL}/api/auth/jwt/create/`, requestOptions).then(handleResponse).then(data => {\n    // store user details and jwt token in local storage to keep user logged in between page refreshes\n    console.log('login ;)');\n    const parsedData = jwtDecode(data.access);\n    const auth = {\n      'access': data.access,\n      'refresh': data.refresh,\n      'data': parsedData\n    };\n    localStorage.setItem('auth', JSON.stringify(auth));\n    Auth.next(auth);\n    console.log(Auth);\n    return auth;\n  });\n}\n\nfunction logout() {\n  // remove user from local storage to log user out\n  localStorage.removeItem('auth');\n  Auth.next(null);\n}\n\nfunction refresh() {\n  // remove user from local storage to log user out\n  let auth = JSON.parse(localStorage.getItem('auth'));\n  console.log('REFRESHHH', auth);\n\n  if (auth.refresh) {\n    const requestOptions = {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json'\n      },\n      body: JSON.stringify({\n        'refresh': auth.refresh\n      })\n    };\n    console.log('refreshh the ting', requestOptions, {\n      'refresh': auth.refresh\n    });\n    return fetch(`${config.PAYTOK_URL}/api/auth/jwt/refresh/`, requestOptions).then(handleResponse).then(data => {\n      // store user details and jwt token in local storage to keep user logged in between page refreshes\n      console.log('refresh :/', data);\n      const parsedData = jwtDecode(data.access);\n      data.data = parsedData;\n      auth = Object.assign({}, auth, data);\n      localStorage.setItem('auth', JSON.stringify(auth));\n      Auth.next(auth);\n      return data;\n    });\n  }\n}","map":{"version":3,"sources":["/Users/tobeyasinugo/dev/facechat_django/frontend/src/services/auth.service.js"],"names":["BehaviorSubject","webSocket","config","handleResponse","jwtDecode","require","Auth","JSON","parse","localStorage","getItem","authenticationService","login","logout","refresh","auth","asObservable","currentUser","value","data","user_id","accessToken","access","refreshToken","tokenExp","exp","username","password","requestOptions","method","headers","body","stringify","fetch","PAYTOK_URL","then","console","log","parsedData","setItem","next","removeItem","Object","assign"],"mappings":"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","sourcesContent":["import { BehaviorSubject } from 'rxjs';\n\nimport { webSocket } from '@akanass/rx-socket-client';\n\nimport config from '../config';\nimport { handleResponse } from '../helpers/handle-response';\n\nvar jwtDecode = require('jwt-decode');\n\nconst Auth = new BehaviorSubject(JSON.parse(localStorage.getItem('auth')));\n\n// const Ws = webSocket(`${config.PAYTOK_WS_URL}/paytok/?${Auth.auth}`);yarn add @akanass/rx-socket-clien√\n\n\n\nexport const authenticationService = {\n    login,\n    logout,\n    refresh,\n    auth: Auth.asObservable(),\n    get currentUser() { return Auth.value && Auth.value.data.user_id },\n    get accessToken() { return Auth.value &&  Auth.value.access },\n    get refreshToken() { return  Auth.value &&  Auth.value.refresh },\n    get tokenExp() { return  Auth.value &&  Auth.value.data.exp }\n    // get WebSoc\n};\n\nfunction login(username, password) {\n    const requestOptions = {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ 'email': username, password })\n    };\n\n    return fetch(`${config.PAYTOK_URL}/api/auth/jwt/create/`, requestOptions)\n        .then(handleResponse)\n        .then(data => {\n            // store user details and jwt token in local storage to keep user logged in between page refreshes\n            console.log('login ;)')\n\n            const parsedData = jwtDecode(data.access)\n            const auth = {\n                'access': data.access,\n                'refresh': data.refresh,\n                'data': parsedData,\n            }\n            localStorage.setItem('auth', JSON.stringify(auth));\n    \n            Auth.next(auth);\n            console.log(Auth)\n            return auth;\n        });\n}\n\nfunction logout(){\n    // remove user from local storage to log user out\n    localStorage.removeItem('auth');\n    Auth.next(null);\n}\n\n\nfunction refresh() {\n    // remove user from local storage to log user out\n    let auth = JSON.parse(localStorage.getItem('auth'))\n    console.log('REFRESHHH', auth)\n    if (auth.refresh) {\n        const requestOptions = {\n            method: 'POST',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify({ 'refresh': auth.refresh })\n        };\n        console.log('refreshh the ting' ,requestOptions, { 'refresh': auth.refresh })\n        return fetch(`${config.PAYTOK_URL}/api/auth/jwt/refresh/`, requestOptions)\n            .then(handleResponse)\n            .then(data => {\n                // store user details and jwt token in local storage to keep user logged in between page refreshes\n                console.log('refresh :/', data)\n                const parsedData = jwtDecode(data.access)\n                data.data = parsedData\n                auth = Object.assign({}, auth, data);\n                localStorage.setItem('auth', JSON.stringify(auth));\n                Auth.next(auth);\n                return data;\n            });\n    }\n}\n\n\n"]},"metadata":{},"sourceType":"module"}